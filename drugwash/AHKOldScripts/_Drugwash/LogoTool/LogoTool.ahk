; LOGO.SYS parameter patcher tool, for use with WLL.COM
; Drugwash, March 2008
; Generated by SmartGUI Creater

#SingleInstance, force
Gui, Submit, NoHide
Gui, Add, Text, x6 y1 w135 h20, Input your values below:
Gui, Add, Text, x6 y20 w67 h20 right, Position H :
Gui, Add, Text, x6 y50 w67 h20 right, Position V :
Gui, Add, Text, x6 y80 w67 h20 right, Width :
Gui, Add, Text, x6 y110 w67 h20 right, Height :
Gui, Add, Text, x6 y140 w67 h20 right, Range :
Gui, Add, Edit, x76 y17 w40 h20 Number Limit3, 1
Gui, Add, UpDown, vPosH Range1-638, 1
GuiControl,, posH, %cposH%
PosH_TT := "Horizontal position of the progressbar top-left corner"
Gui, Add, Edit, x76 y47 w40 h20 Number Limit3, 1
Gui, Add, UpDown, vPosV Range1-478, 1
GuiControl,, posV, %cposV%
PosV_TT := "Vertical position of the progressbar top-left corner"
Gui, Add, Edit, x76 y77 w40 h20 Number Limit3, 1
Gui, Add, UpDown, vProgW Range1-450, 1
GuiControl,, progW, %cprogW%
ProgW_TT := "Progressbar (bullet) width"
Gui, Add, Edit, x76 y107 w40 h20 Number Limit3, 1
Gui, Add, UpDown, vProgH Range1-100, 1
GuiControl,, progH, %cprogH%
ProgH_TT := "Progressbar (bullet) height"
Gui, Add, Edit, x76 y137 w40 h20 Number Limit3,1
Gui, Add, UpDown, vProgL Range1-638, 1
GuiControl,, progL, %cprogL%
ProgL_TT := "Animation shaft width"
Gui, Submit, NoHide
Gui, Add, Text, x118 y20 w17 h15, px
Gui, Add, Text, x118 y50 w17 h15, px.
Gui, Add, Text, x118 y80 w17 h15, px.
Gui, Add, Text, x118 y110 w17 h15, px.
Gui, Add, Text, x118 y140 w17 h15, px.
Gui, Add, Button, x6 y161 w40 h25 default, Open
Open_TT := "Open a bitmap file to be patched"
Gui, Add, Button, x51 y161 w40 h25, Patch
Patch_TT := "Add the values to your bitmap"
Gui, Add, Button, x96 y161 w40 h25, Exit
Exit_TT := "Close the program"
Gui, Show, h192 w142, LOGO tool
OnMessage(0x200, "WM_MOUSEMOVE")
Return

WM_MOUSEMOVE()
{
    static CurrControl, PrevControl, _TT  ; _TT is kept blank for use by the ToolTip command below.
    CurrControl := A_GuiControl
    if (CurrControl <> PrevControl and not InStr(CurrControl, " "))
    {
        ToolTip  ; Turn off any previous tooltip.
        SetTimer, DisplayToolTip, 1000
        PrevControl := CurrControl
    }
    return

    DisplayToolTip:
    SetTimer, DisplayToolTip, Off
    ToolTip % %CurrControl%_TT  ; The leading percent sign tell it to use an expression.
    SetTimer, RemoveToolTip, 3000
    return

    RemoveToolTip:
    SetTimer, RemoveToolTip, Off
    ToolTip
    return
}

ButtonOpen:
Gui +OwnDialogs
FileSelectFile, mylogo, 3, .\, Open a bitmap file, Logo bitmaps (*.bmp; logo.sys)
	if mylogo =
	{
		MsgBox, 12336, Error, You haven't selected a bitmap file to patch.,
		return
	}
	else
;		MsgBox, You selected the file :`n%mylogo%
FileGetSize, Lsize, %mylogo%
	if Lsize <> 308278
	{
		MsgBox, 12336, Error, The file is %Lsize% bytes.`n`nYou chose an inappropriate file to patch.`nPlease choose a 640x480px 256colors bitmap.,
		return
	}
	else
	{
mystring := VarSetCapacity(topatch, 308278, 0)
		FileRead, topatch, %mylogo%
		cposH := *(&topatch + 1078) + *(&topatch + 1079)*256
		cposV := *(&topatch + 1080) + *(&topatch + 1081)*256
		cprogW := *(&topatch + 1082) + *(&topatch + 1083)*256
		cprogH := *(&topatch + 1084) + *(&topatch + 1085)*256
		cprogL := *(&topatch + 1086) + *(&topatch + 1087)*256
;		MsgBox, The file is %Lsize% bytes.`nVariables are as following:`ncurrent PosH=%cposH% - new=%PosH%`ncurrent PosV=%cposV% - new=%PosV%`ncurrent ProgW=%cprogW% - new=%ProgW%`ncurrent ProgH=%cprogH% - new=%ProgH%`ncurrent ProgL=%cprogL% - new=%ProgL%
Gui, Submit, NoHide
GuiControl,, t1, %cposH%
GuiControl,, t2, %cposV%
GuiControl,, t3, %cprogW%
GuiControl,, t4, %cprogH%
GuiControl,, t5, %cprogL%
GuiControl,, posH, %cposH%
GuiControl,, posV, %cposV%
GuiControl,, progW, %cprogW%
GuiControl,, progH, %cprogH%
GuiControl,, progL, %cprogL%
	}
return

ButtonPatch:
Gui, Submit, NoHide
		NumPut(PosH, topatch, 1078, "UShort")
		NumPut(PosV, topatch, 1080, "UShort")
		NumPut(ProgW, topatch, 1082, "UShort")
		NumPut(ProgH, topatch, 1084, "UShort")
		NumPut(ProgL, topatch, 1086, "UShort")
		FileSelectFile, patched, s26, .\LOGO.SYS, Save patched bitmap as:, WLL logo files (logo.sys)
	if patched =
	{
		MsgBox, 12336, Error, You haven't selected a name for saving the patched file.,
		return
	}
	hFile := DllCall("CreateFile", str, patched, Uint, 0x40000000, Uint, 0, Uint, 0, Uint, 2, Uint, 0, Uint, 0)
	if not hFile
	{
	    MsgBox Couldn't create "%patched%".
	    return
	}
	DllCall("WriteFile", UInt, hFile, str, topatch, UInt, mystring, UIntP, BytesActuallyWritten, UInt, 0)
	DllCall("CloseHandle", UInt, hFile)
;	MsgBox I have written %BytesActuallyWritten% bytes.`n`n`nVariable 'topatch' is %mystring% bytes.
	hFile := DllCall("CreateFile", str, patched, UInt, 0x80000000, UInt, 1|2, UInt, 0, UInt, 3, Uint, 0, UInt, 0)
	if not hFile
	{
	    MsgBox Can't open "%patched%" for reading.
	    return
	}
	BytesToRead := VarSetCapacity(topatch, StrLen(topatch))
	DllCall("ReadFile", UInt, hFile, str, topatch, UInt, BytesToRead, UIntP, BytesActuallyRead, UInt, 0)
	DllCall("CloseHandle", UInt, hFile)  ; Close the file.
		nposH := *(&topatch + 1078) + *(&topatch + 1079)*256
		nposV := *(&topatch + 1080) + *(&topatch + 1081)*256
		nprogW := *(&topatch + 1082) + *(&topatch + 1083)*256
		nprogH := *(&topatch + 1084) + *(&topatch + 1085)*256
		nprogL := *(&topatch + 1086) + *(&topatch + 1087)*256
;		MsgBox The following values were read from the file :`ncurrent PosH=%nposH%`ncurrent PosV=%nposV%`ncurrent ProgW=%nprogW%`ncurrent ProgH=%nprogH%`ncurrent ProgL=%nprogL%
return

ButtonExit:
GuiClose:
ExitApp